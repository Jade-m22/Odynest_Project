<h1 class="user-dashboard-title">Tableau de bord</h1>

<% if current_user.is_admin? %>
  <section class="user-dashboard-section">
    <h2 class="user-dashboard-section-title playfair-bold">Liste des expériences en cours</h2>
    <table class="user-dashboard-table">
      <thead>
        <tr>
          <th>Expérience</th>
          <th>Lieu</th>
          <th>Participants</th>
          <th>Avis</th>
        </tr>
      </thead>
      <tbody>
        <% @experiences.each do |experience| %>
          <tr>
            <td><%= link_to experience.title, experience_path(experience) %></td>
            <td><%= experience.location %></td>
            <td>
              <% experience.users.each do |user| %>
                <%= user.email %><br>
              <% end %>
            </td>
            <td>
              <% if experience.reviews.any? %>
                <ul>
                  <% experience.reviews.each do |review| %>
                    <li><strong><%= review.user.name %></strong>: <%= review.rating %>/5 - "<%= review.comment %>"</li>
                  <% end %>
                </ul>
              <% else %>
                Aucun avis
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>

  <section class="user-dashboard-section">
    <h2 class="user-dashboard-section-title playfair-bold">Gestion</h2> 
    <%= link_to "Voir tous les utilisateurs", users_path, class: "user-dashboard-btn user-dashboard-btn-primary" %>
    <%= link_to "Voir tous les providers", providers_path, class: "user-dashboard-btn user-dashboard-btn-secondary" %>
  </section>

<% else %>
  <section class="user-dashboard-section">
    <h2 class="user-dashboard-section-title playfair-bold">Mes Expériences Réservées</h2>
    <% if @reservations.any? %>
      <table class="user-dashboard-table">
        <thead>
          <tr>
            <th>Expérience</th>
            <th>Lieu</th>
            <th>Date Réservée</th>
            <th>Avis</th>
          </tr>
        </thead>
        <tbody>
          <% @reservations.each do |reservation| %>
            <tr>
              <td><%= link_to reservation.experience.title, experience_path(reservation.experience) %></td>
              <td><%= reservation.experience.location %></td>
              <td><%= l(reservation.reservation_date, format: :long) %></td>
              <td>
                <% if reservation.experience.reviews.any? %>
                  <ul>
                    <% reservation.experience.reviews.each do |review| %>
                      <li><strong><%= review.user.name %></strong>: <%= review.rating %>/5 - "<%= review.comment %>"</li>
                    <% end %>
                  </ul>
                <% else %>
                  Aucun avis
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>Vous n'avez réservé aucune expérience pour l'instant.</p>
    <% end %>
  </section>

  <section class="user-dashboard-section">
    <h2 class="user-dashboard-section-title playfair-bold">Mes Expériences en tant que Prestataire</h2>
    <% if @experiences.any? %>
      <% @experiences.each do |experience| %>
        <div class="experience-card">
          <h3><%= experience.title %></h3>
          <p><%= experience.description %></p>

          <h4>Avis des clients :</h4>
          <% if experience.reviews.any? %>
            <% experience.reviews.each do |review| %>
              <div class="review">
                <p><strong><%= review.user.name %></strong> - Note : <%= review.rating %>/5</p>
                <p><%= review.comment %></p>
                <p><em>Posté le <%= review.created_at.strftime("%d/%m/%Y") %></em></p>
              </div>
            <% end %>
          <% else %>
            <p>Aucun avis pour cette expérience.</p>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <p>Vous n'avez proposé aucune expérience pour l'instant.</p>
    <% end %>
  </section>
<% end %>
